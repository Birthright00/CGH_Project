<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Session - Changi General Hospital</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            min-height: 100vh;
        }

        .header {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: #2196F3;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .nav {
            display: flex;
            gap: 2rem;
        }

        .nav a {
            color: #2196F3;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav a:hover {
            color: #1976D2;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-title {
            font-size: 2.5rem;
            color: #1976D2;
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: #666;
            font-size: 1.1rem;
        }

        .form-container {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .form-section {
            margin-bottom: 2.5rem;
        }

        .section-title {
            font-size: 1.3rem;
            color: #1976D2;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-icon {
            width: 24px;
            height: 24px;
            background: #2196F3;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        select, input, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #2196F3;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .template-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .template-card:hover {
            border-color: #2196F3;
            transform: translateY(-2px);
        }

        .template-card.selected {
            border-color: #2196F3;
            background: #e3f2fd;
        }

        .template-icon {
            width: 48px;
            height: 48px;
            background: #f5f5f5;
            border-radius: 50%;
            margin: 0 auto 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .template-preview {
            margin-top: 1rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #2196F3;
            display: none;
        }

        .template-preview.show {
            display: block;
        }

        .template-preview h4 {
            color: #1976D2;
            margin-bottom: 1rem;
        }

        .preview-content {
            background: white;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .doctor-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .rank-badge {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }

        .rank-consultant {
            background: #4CAF50;
            color: white;
        }

        .rank-senior {
            background: #FF9800;
            color: white;
        }

        .rank-resident {
            background: #2196F3;
            color: white;
        }

        .rank-intern {
            background: #9E9E9E;
            color: white;
        }

        .timetable-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .timetable-options {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .timetable-option {
            padding: 0.5rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .timetable-option.active {
            border-color: #2196F3;
            background: #e3f2fd;
        }

        .timetable-grid {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 1rem;
        }

        .timetable-header {
            display: grid;
            grid-template-columns: 100px repeat(7, 1fr);
            background: #2196F3;
            color: white;
        }

        .timetable-header div {
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            border-right: 1px solid rgba(255,255,255,0.2);
        }

        .timetable-row {
            display: grid;
            grid-template-columns: 100px repeat(7, 1fr);
            border-bottom: 1px solid #e0e0e0;
        }

        .time-slot {
            padding: 0.75rem;
            text-align: center;
            background: #f5f5f5;
            font-weight: 600;
            border-right: 1px solid #e0e0e0;
        }

        .slot-cell {
            padding: 0.5rem;
            border-right: 1px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .slot-cell:hover {
            background: #e3f2fd;
        }

        .slot-cell.selected {
            background: #4CAF50;
            color: white;
        }

        .slot-cell.unavailable {
            background: #ffebee;
            color: #c62828;
            cursor: not-allowed;
        }

        .date-selector {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .date-range {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .doctors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .doctor-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .doctor-card:hover {
            border-color: #2196F3;
            transform: translateY(-2px);
        }

        .doctor-card.selected {
            border-color: #2196F3;
            background: #e3f2fd;
        }

        .doctor-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .doctor-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(45deg, #2196F3, #21CBF3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .doctor-details h3 {
            margin-bottom: 0.25rem;
            color: #333;
        }

        .doctor-details p {
            color: #666;
            font-size: 0.9rem;
        }

        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .students-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
        }

        .student-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .student-item:hover {
            background: #f5f5f5;
        }

        .student-checkbox {
            margin-right: 0.5rem;
        }

        .student-info {
            flex: 1;
        }

        .student-name {
            font-weight: 500;
            color: #333;
        }

        .student-details {
            font-size: 0.8rem;
            color: #666;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #e0e0e0;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #2196F3;
            color: white;
        }

        .btn-primary:hover {
            background: #1976D2;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #666;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .selected-count {
            background: #4CAF50;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <div class="logo-icon">+</div>
            <div>
                <strong>Changi</strong><br>
                <span style="font-size: 0.9rem;">General Hospital</span>
            </div>
        </div>
        <nav class="nav">
            <a href="#home">Home</a>
            <a href="#schedule">Schedule</a>
            <a href="#about">About Me</a>
            <a href="#back">Back</a>
            <a href="#logout">Log Out</a>
        </nav>
    </div>

    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Create New Session</h1>
            <p class="page-subtitle">Set up a new timetable session and notify relevant doctors and students</p>
        </div>

        <div class="form-container">
            <!-- Session Details -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-icon">📋</span>
                    Session Details
                </h2>
                <div class="form-group">
                    <label for="sessionName">Session Name</label>
                    <input type="text" id="sessionName" placeholder="e.g., Internal Medicine Rotation - Week 3">
                </div>
                <div class="form-group">
                    <label for="sessionDescription">Description</label>
                    <textarea id="sessionDescription" rows="3" placeholder="Brief description of the session..."></textarea>
                </div>
            </div>

            <!-- Template Selection -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-icon">📄</span>
                    Select Template
                </h2>
                <div class="template-grid">
                    <div class="template-card" onclick="selectTemplate('clinical')">
                        <div class="template-icon">🏥</div>
                        <h3>Clinical Rotation</h3>
                        <p>Standard clinical training schedule</p>
                    </div>
                    <div class="template-card" onclick="selectTemplate('lecture')">
                        <div class="template-icon">📚</div>
                        <h3>Lecture Series</h3>
                        <p>Academic lecture timetable</p>
                    </div>
                    <div class="template-card" onclick="selectTemplate('exam')">
                        <div class="template-icon">📝</div>
                        <h3>Examination</h3>
                        <p>Assessment and exam schedule</p>
                    </div>
                    <div class="template-card" onclick="selectTemplate('workshop')">
                        <div class="template-icon">🛠️</div>
                        <h3>Workshop</h3>
                        <p>Hands-on training sessions</p>
                    </div>
                </div>
                
                <!-- Template Preview -->
                <div class="template-preview" id="templatePreview">
                    <h4>Email Preview:</h4>
                    <div class="preview-content" id="previewContent">
                        <!-- Preview will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Doctor Selection -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-icon">👨‍⚕️</span>
                    Select Doctors to Notify
                    <span class="selected-count" id="doctorCount">0 selected</span>
                </h2>
                
                <div class="doctor-filters">
                    <div class="form-group">
                        <label for="department">Department</label>
                        <select id="department" onchange="filterDoctors()">
                            <option value="">All Departments</option>
                            <option value="Internal Medicine">Internal Medicine</option>
                            <option value="Cardiology">Cardiology</option>
                            <option value="Emergency Medicine">Emergency Medicine</option>
                            <option value="Surgery">Surgery</option>
                            <option value="Pediatrics">Pediatrics</option>
                            <option value="Radiology">Radiology</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="rank">Rank</label>
                        <select id="rank" onchange="filterDoctors()">
                            <option value="">All Ranks</option>
                            <option value="Consultant">Consultant</option>
                            <option value="Senior Resident">Senior Resident</option>
                            <option value="Resident">Resident</option>
                            <option value="Intern">Intern</option>
                        </select>
                    </div>
                </div>
                
                <div class="doctors-grid" id="doctorsGrid">
                    <!-- Doctors will be populated by JavaScript -->
                </div>
                
                <!-- Timetable Visual Selection -->
                <div class="timetable-section" id="timetableSection" style="display: none;">
                    <h3>Available Time Slots</h3>
                    <p>Select the time slots you want to include in the notification to doctors:</p>
                    
                    <div class="date-selector">
                        <label>Date Range:</label>
                        <div class="date-range">
                            <input type="date" id="startDate" onchange="updateTimetable()">
                            <span>to</span>
                            <input type="date" id="endDate" onchange="updateTimetable()">
                        </div>
                    </div>
                    
                    <div class="timetable-options">
                        <div class="timetable-option active" onclick="setTimetableMode('weekly')">Weekly Schedule</div>
                        <div class="timetable-option" onclick="setTimetableMode('specific')">Specific Days</div>
                    </div>
                    
                    <div class="timetable-grid" id="timetableGrid">
                        <!-- Timetable will be generated by JavaScript -->
                    </div>
                    
                    <div style="margin-top: 1rem; font-size: 0.9rem; color: #666;">
                        <span style="display: inline-block; width: 20px; height: 20px; background: #4CAF50; margin-right: 5px; vertical-align: middle;"></span> Selected
                        <span style="display: inline-block; width: 20px; height: 20px; background: #ffebee; margin: 0 5px 0 15px; vertical-align: middle;"></span> Unavailable
                        <span style="display: inline-block; width: 20px; height: 20px; background: white; border: 1px solid #e0e0e0; margin-left: 5px; vertical-align: middle;"></span> Available
                    </div>
                </div>
            </div>

            <!-- Student Selection -->
            <div class="form-section">
                <h2 class="section-title">
                    <span class="section-icon">🎓</span>
                    Select Students
                    <span class="selected-count" id="studentCount">0 selected</span>
                </h2>
                
                <div class="filter-controls">
                    <div class="form-group">
                        <label for="academicYear">Academic Year</label>
                        <select id="academicYear" onchange="filterStudents()">
                            <option value="">All Years</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="school">School</label>
                        <select id="school" onchange="filterStudents()">
                            <option value="">All Schools</option>
                            <option value="NUS">NUS Medicine</option>
                            <option value="NTU">NTU Medicine</option>
                            <option value="SMU">SMU Medicine</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="yearLevel">Year Level</label>
                        <select id="yearLevel" onchange="filterStudents()">
                            <option value="">All Levels</option>
                            <option value="1">Year 1</option>
                            <option value="2">Year 2</option>
                            <option value="3">Year 3</option>
                            <option value="4">Year 4</option>
                            <option value="5">Year 5</option>
                        </select>
                    </div>
                </div>

                <div class="students-list" id="studentsList">
                    <!-- Students will be populated by JavaScript -->
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="cancelSession()">Cancel</button>
                <button class="btn btn-primary" onclick="createSession()">Create Session & Send Notifications</button>
            </div>
        </div>
    </div>

    <script>
        // Sample data
        const doctors = [
            { id: 'dr1', name: 'Dr. Sarah Chen', department: 'Internal Medicine', rank: 'Consultant', email: 'sarah.chen@cgh.com.sg' },
            { id: 'dr2', name: 'Dr. Michael Lim', department: 'Cardiology', rank: 'Senior Resident', email: 'michael.lim@cgh.com.sg' },
            { id: 'dr3', name: 'Dr. Priya Tan', department: 'Emergency Medicine', rank: 'Consultant', email: 'priya.tan@cgh.com.sg' },
            { id: 'dr4', name: 'Dr. James Wong', department: 'Surgery', rank: 'Consultant', email: 'james.wong@cgh.com.sg' },
            { id: 'dr5', name: 'Dr. Lisa Kumar', department: 'Pediatrics', rank: 'Resident', email: 'lisa.kumar@cgh.com.sg' },
            { id: 'dr6', name: 'Dr. Robert Tan', department: 'Radiology', rank: 'Senior Resident', email: 'robert.tan@cgh.com.sg' },
            { id: 'dr7', name: 'Dr. Amy Lee', department: 'Internal Medicine', rank: 'Intern', email: 'amy.lee@cgh.com.sg' },
            { id: 'dr8', name: 'Dr. David Ng', department: 'Surgery', rank: 'Resident', email: 'david.ng@cgh.com.sg' }
        ];

        const students = [
            { id: 1, name: "Alex Tan", email: "alex.tan@student.edu.sg", school: "NUS", year: 2024, level: 3 },
            { id: 2, name: "Michelle Lee", email: "michelle.lee@student.edu.sg", school: "NUS", year: 2024, level: 3 },
            { id: 3, name: "David Chen", email: "david.chen@student.edu.sg", school: "NTU", year: 2025, level: 2 },
            { id: 4, name: "Sarah Kim", email: "sarah.kim@student.edu.sg", school: "SMU", year: 2024, level: 4 },
            { id: 5, name: "John Lim", email: "john.lim@student.edu.sg", school: "NUS", year: 2025, level: 1 },
            { id: 6, name: "Emily Wong", email: "emily.wong@student.edu.sg", school: "NTU", year: 2024, level: 3 },
            { id: 7, name: "Marcus Teo", email: "marcus.teo@student.edu.sg", school: "SMU", year: 2025, level: 2 },
            { id: 8, name: "Lisa Zhang", email: "lisa.zhang@student.edu.sg", school: "NUS", year: 2024, level: 4 }
        ];

        const templatePreviews = {
            clinical: {
                subject: "Clinical Rotation Schedule - [SESSION_NAME]",
                content: `Dear Dr. [DOCTOR_NAME],

You are invited to participate in the upcoming clinical rotation:

Session: [SESSION_NAME]
Department: [DEPARTMENT]
Date(s): [DATE_RANGE]
Time: [TIME_SLOTS]

Students Assigned: [STUDENT_COUNT] students
- [STUDENT_LIST]

Please confirm your availability for the selected time slots.

Best regards,
Medical Education Department
Changi General Hospital`
            },
            lecture: {
                subject: "Lecture Series Invitation - [SESSION_NAME]",
                content: `Dear Dr. [DOCTOR_NAME],

You are invited to deliver a lecture as part of our educational series:

Topic: [SESSION_NAME]
Date(s): [DATE_RANGE]
Time: [TIME_SLOTS]
Venue: [VENUE]

Expected Audience: [STUDENT_COUNT] medical students

Please let us know if you can accommodate this request.

Best regards,
Academic Affairs
Changi General Hospital`
            },
            exam: {
                subject: "Examination Schedule - [SESSION_NAME]",
                content: `Dear Dr. [DOCTOR_NAME],

You are requested to participate in the following examination:

Examination: [SESSION_NAME]
Date(s): [DATE_RANGE]
Time: [TIME_SLOTS]
Role: [EXAMINER_ROLE]

Students: [STUDENT_COUNT] candidates

Please confirm your availability.

Best regards,
Examination Board
Changi General Hospital`
            },
            workshop: {
                subject: "Workshop Facilitation - [SESSION_NAME]",
                content: `Dear Dr. [DOCTOR_NAME],

You are invited to facilitate the following workshop:

Workshop: [SESSION_NAME]
Date(s): [DATE_RANGE]
Time: [TIME_SLOTS]
Format: Hands-on training

Participants: [STUDENT_COUNT] students

Please confirm your participation.

Best regards,
Training Department
Changi General Hospital`
            }
        };

        let selectedDoctors = new Set();
        let selectedStudents = new Set();
        let selectedTemplate = null;
        let selectedTimeSlots = new Set();
        let timetableMode = 'weekly';

        function selectTemplate(templateId) {
            // Remove previous selection
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked template
            event.target.closest('.template-card').classList.add('selected');
            selectedTemplate = templateId;
            
            // Show preview
            showTemplatePreview(templateId);
            
            // Show timetable section
            document.getElementById('timetableSection').style.display = 'block';
            generateTimetable();
        }

        function showTemplatePreview(templateId) {
            const preview = document.getElementById('templatePreview');
            const content = document.getElementById('previewContent');
            
            if (templatePreviews[templateId]) {
                const sessionName = document.getElementById('sessionName').value || '[Session Name]';
                const template = templatePreviews[templateId];
                
                content.innerHTML = `
                    <strong>Subject:</strong> ${template.subject.replace('[SESSION_NAME]', sessionName)}<br><br>
                    <strong>Body:</strong><br>
                    ${template.content.replace(/\[SESSION_NAME\]/g, sessionName)
                                    .replace(/\n/g, '<br>')}
                `;
                
                preview.classList.add('show');
            }
        }

        function filterDoctors() {
            const department = document.getElementById('department').value;
            const rank = document.getElementById('rank').value;

            let filteredDoctors = doctors.filter(doctor => {
                return (!department || doctor.department === department) &&
                       (!rank || doctor.rank === rank);
            });

            renderDoctors(filteredDoctors);
        }

        function renderDoctors(doctorsToRender = doctors) {
            const doctorsGrid = document.getElementById('doctorsGrid');
            doctorsGrid.innerHTML = '';

            doctorsToRender.forEach(doctor => {
                const initials = doctor.name.split(' ').map(n => n[0]).join('');
                const rankClass = doctor.rank.toLowerCase().replace(' ', '-');
                
                const doctorCard = document.createElement('div');
                doctorCard.className = `doctor-card ${selectedDoctors.has(doctor.id) ? 'selected' : ''}`;
                doctorCard.onclick = () => toggleDoctor(doctor.id);
                
                doctorCard.innerHTML = `
                    <div class="doctor-info">
                        <div class="doctor-avatar">${initials}</div>
                        <div class="doctor-details">
                            <h3>${doctor.name}<span class="rank-badge rank-${rankClass.replace(' ', '')}">${doctor.rank}</span></h3>
                            <p>${doctor.department}</p>
                            <p>${doctor.email}</p>
                        </div>
                    </div>
                `;
                
                doctorsGrid.appendChild(doctorCard);
            });
        }

        function toggleDoctor(doctorId) {
            if (selectedDoctors.has(doctorId)) {
                selectedDoctors.delete(doctorId);
            } else {
                selectedDoctors.add(doctorId);
            }
            
            updateDoctorCount();
            renderDoctors(getFilteredDoctors());
        }

        function getFilteredDoctors() {
            const department = document.getElementById('department').value;
            const rank = document.getElementById('rank').value;

            return doctors.filter(doctor => {
                return (!department || doctor.department === department) &&
                       (!rank || doctor.rank === rank);
            });
        }

        function setTimetableMode(mode) {
            timetableMode = mode;
            document.querySelectorAll('.timetable-option').forEach(opt => {
                opt.classList.remove('active');
            });
            event.target.classList.add('active');
            generateTimetable();
        }

        function generateTimetable() {
            const grid = document.getElementById('timetableGrid');
            const timeSlots = ['08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'];
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            
            let html = '<div class="timetable-header">';
            html += '<div>Time</div>';
            days.forEach(day => {
                html += `<div>${day}</div>`;
            });
            html += '</div>';
            
            timeSlots.forEach(time => {
                html += '<div class="timetable-row">';
                html += `<div class="time-slot">${time}</div>`;
                
                days.forEach(day => {
                    const slotId = `${day}-${time}`;
                    const isSelected = selectedTimeSlots.has(slotId);
                    const isUnavailable = Math.random() < 0.1; // 10% chance of being unavailable
                    
                    let cellClass = 'slot-cell';
                    if (isSelected) cellClass += ' selected';
                    if (isUnavailable) cellClass += ' unavailable';
                    
                    html += `<div class="${cellClass}" onclick="toggleTimeSlot('${slotId}')" ${isUnavailable ? 'title="Unavailable"' : ''}></div>`;
                });
                
                html += '</div>';
            });
            
            grid.innerHTML = html;
        }

        function toggleTimeSlot(slotId) {
            if (event.target.classList.contains('unavailable')) return;
            
            if (selectedTimeSlots.has(slotId)) {
                selectedTimeSlots.delete(slotId);
                event.target.classList.remove('selected');
            } else {
                selectedTimeSlots.add(slotId);
                event.target.classList.add('selected');
            }
        }

        function updateTimetable() {
            // This would typically update the timetable based on date range
            generateTimetable();
        }

        function updateDoctorCount() {
            document.getElementById('doctorCount').textContent = `${selectedDoctors.size} selected`;
        }

        function toggleStudent(studentId) {
            if (selectedStudents.has(studentId)) {
                selectedStudents.delete(studentId);
            } else {
                selectedStudents.add(studentId);
            }
            updateStudentCount();
        }

        function updateStudentCount() {
            document.getElementById('studentCount').textContent = `${selectedStudents.size} selected`;
        }

        function filterStudents() {
            const academicYear = document.getElementById('academicYear').value;
            const school = document.getElementById('school').value;
            const yearLevel = document.getElementById('yearLevel').value;

            let filteredStudents = students.filter(student => {
                return (!academicYear || student.year.toString() === academicYear) &&
                       (!school || student.school === school) &&
                       (!yearLevel || student.level.toString() === yearLevel);
            });

            renderStudents(filteredStudents);
        }

        function renderStudents(studentsToRender = students) {
            const studentsList = document.getElementById('studentsList');
            studentsList.innerHTML = '';

            studentsToRender.forEach(student => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                studentItem.innerHTML = `
                    <input type="checkbox" class="student-checkbox" 
                           ${selectedStudents.has(student.id) ? 'checked' : ''}
                           onchange="toggleStudent(${student.id})">
                    <div class="student-info">
                        <div class="student-name">${student.name}</div>
                        <div class="student-details">${student.school} • Year ${student.level} • ${student.year} • ${student.email}</div>
                    </div>
                `;
                studentsList.appendChild(studentItem);
            });
        }

        function createSession() {
            if (!selectedTemplate) {
                alert('Please select a template');
                return;
            }
            if (selectedDoctors.size === 0) {
                alert('Please select at least one doctor');
                return;
            }
            if (selectedStudents.size === 0) {
                alert('Please select at least one student');
                return;
            }

            const sessionName = document.getElementById('sessionName').value;
            if (!sessionName.trim()) {
                alert('Please enter a session name');
                return;
            }

            // Here you would typically send the data to your backend
            alert(`Session "${sessionName}" created successfully!\n\nNotifications will be sent to:\n- ${selectedDoctors.size} doctors\n- ${selectedStudents.size} students`);
        }

        function cancelSession() {
            if (confirm('Are you sure you want to cancel? All unsaved changes will be lost.')) {
                // Navigate back or clear form
                window.history.back();
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            renderStudents();
            renderDoctors();
            
            // Set default dates
            const today = new Date();
            const nextWeek = new Date(today);
            nextWeek.setDate(today.getDate() + 7);
            
            document.getElementById('startDate').value = today.toISOString().split('T')[0];
            document.getElementById('endDate').value = nextWeek.toISOString().split('T')[0];
        });
    </script>
</body>
</html>